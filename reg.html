<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=lhDjYqiy3mZ0x6ROQEUoUw);ul.lst-kix_dmry3b4ukcx-5{list-style-type:none}ul.lst-kix_dmry3b4ukcx-6{list-style-type:none}ul.lst-kix_dmry3b4ukcx-7{list-style-type:none}ul.lst-kix_dmry3b4ukcx-8{list-style-type:none}ul.lst-kix_dmry3b4ukcx-1{list-style-type:none}ul.lst-kix_dmry3b4ukcx-2{list-style-type:none}ul.lst-kix_dmry3b4ukcx-3{list-style-type:none}ul.lst-kix_dmry3b4ukcx-4{list-style-type:none}ul.lst-kix_dmry3b4ukcx-0{list-style-type:none}.lst-kix_evk7hl6oz3ai-7>li:before{content:"\0025cb   "}.lst-kix_evk7hl6oz3ai-8>li:before{content:"\0025a0   "}ul.lst-kix_2fga0uz7f54-4{list-style-type:none}ul.lst-kix_2fga0uz7f54-5{list-style-type:none}ul.lst-kix_2fga0uz7f54-6{list-style-type:none}ul.lst-kix_2fga0uz7f54-7{list-style-type:none}ul.lst-kix_2fga0uz7f54-8{list-style-type:none}.lst-kix_2fga0uz7f54-0>li:before{content:"\0025cf   "}.lst-kix_dmry3b4ukcx-5>li:before{content:"\0025a0   "}.lst-kix_dmry3b4ukcx-7>li:before{content:"\0025cb   "}ul.lst-kix_2fga0uz7f54-0{list-style-type:none}.lst-kix_2fga0uz7f54-1>li:before{content:"\0025cb   "}ul.lst-kix_2fga0uz7f54-1{list-style-type:none}ul.lst-kix_2fga0uz7f54-2{list-style-type:none}.lst-kix_evk7hl6oz3ai-0>li:before{content:"\0025cf   "}ul.lst-kix_2fga0uz7f54-3{list-style-type:none}.lst-kix_dmry3b4ukcx-4>li:before{content:"\0025cb   "}.lst-kix_dmry3b4ukcx-8>li:before{content:"\0025a0   "}.lst-kix_2fga0uz7f54-2>li:before{content:"\0025a0   "}.lst-kix_2fga0uz7f54-3>li:before{content:"\0025cf   "}.lst-kix_dmry3b4ukcx-1>li:before{content:"\0025cb   "}.lst-kix_dmry3b4ukcx-3>li:before{content:"\0025cf   "}.lst-kix_evk7hl6oz3ai-5>li:before{content:"\0025a0   "}.lst-kix_2fga0uz7f54-4>li:before{content:"\0025cb   "}.lst-kix_evk7hl6oz3ai-6>li:before{content:"\0025cf   "}.lst-kix_dmry3b4ukcx-2>li:before{content:"\0025a0   "}.lst-kix_2fga0uz7f54-6>li:before{content:"\0025cf   "}.lst-kix_2fga0uz7f54-7>li:before{content:"\0025cb   "}.lst-kix_2fga0uz7f54-5>li:before{content:"\0025a0   "}.lst-kix_evk7hl6oz3ai-4>li:before{content:"\0025cb   "}.lst-kix_evk7hl6oz3ai-3>li:before{content:"\0025cf   "}.lst-kix_evk7hl6oz3ai-1>li:before{content:"\0025cb   "}.lst-kix_2fga0uz7f54-8>li:before{content:"\0025a0   "}.lst-kix_evk7hl6oz3ai-2>li:before{content:"\0025a0   "}.lst-kix_dmry3b4ukcx-6>li:before{content:"\0025cf   "}.lst-kix_dmry3b4ukcx-0>li:before{content:"\0025cf   "}ul.lst-kix_evk7hl6oz3ai-8{list-style-type:none}ul.lst-kix_evk7hl6oz3ai-7{list-style-type:none}ul.lst-kix_evk7hl6oz3ai-6{list-style-type:none}ul.lst-kix_evk7hl6oz3ai-1{list-style-type:none}ul.lst-kix_evk7hl6oz3ai-0{list-style-type:none}ul.lst-kix_evk7hl6oz3ai-5{list-style-type:none}ul.lst-kix_evk7hl6oz3ai-4{list-style-type:none}ul.lst-kix_evk7hl6oz3ai-3{list-style-type:none}ul.lst-kix_evk7hl6oz3ai-2{list-style-type:none}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}ol{margin:0;padding:0}table td,table th{padding:0}.c3{border-right-style:solid;padding:5pt 10pt 5pt 10pt;border-bottom-color:#3d444d;border-top-width:1pt;border-right-width:1pt;border-left-color:#3d444d;vertical-align:top;border-right-color:#3d444d;border-left-width:1pt;border-top-style:solid;background-color:#212830;border-left-style:solid;border-bottom-width:1pt;width:51pt;border-top-color:#3d444d;border-bottom-style:solid}.c14{border-right-style:solid;padding:5pt 10pt 5pt 10pt;border-bottom-color:#3d444d;border-top-width:1pt;border-right-width:1pt;border-left-color:#3d444d;vertical-align:top;border-right-color:#3d444d;border-left-width:1pt;border-top-style:solid;background-color:#212830;border-left-style:solid;border-bottom-width:1pt;width:72.8pt;border-top-color:#3d444d;border-bottom-style:solid}.c13{border-right-style:solid;padding:5pt 10pt 5pt 10pt;border-bottom-color:#3d444d;border-top-width:1pt;border-right-width:1pt;border-left-color:#3d444d;vertical-align:top;border-right-color:#3d444d;border-left-width:1pt;border-top-style:solid;background-color:#212830;border-left-style:solid;border-bottom-width:1pt;width:250.5pt;border-top-color:#3d444d;border-bottom-style:solid}.c9{border-right-style:solid;padding:5pt 10pt 5pt 10pt;border-bottom-color:#3d444d;border-top-width:1pt;border-right-width:1pt;border-left-color:#3d444d;vertical-align:top;border-right-color:#3d444d;border-left-width:1pt;border-top-style:solid;background-color:#212830;border-left-style:solid;border-bottom-width:1pt;width:52.5pt;border-top-color:#3d444d;border-bottom-style:solid}.c20{border-right-style:solid;padding:5pt 10pt 5pt 10pt;border-bottom-color:#3d444d;border-top-width:1pt;border-right-width:1pt;border-left-color:#3d444d;vertical-align:top;border-right-color:#3d444d;border-left-width:1pt;border-top-style:solid;background-color:#212830;border-left-style:solid;border-bottom-width:1pt;width:54.8pt;border-top-color:#3d444d;border-bottom-style:solid}.c30{padding-top:0pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c11{color:#434343;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Arial";font-style:normal}.c8{color:#d1d7e0;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c5{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Consolas";font-style:normal}.c21{padding-top:16pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c6{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c0{padding-top:0pt;padding-bottom:12pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c7{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c10{font-size:9pt;font-family:"Consolas";color:#d1d7e0;font-weight:400}.c24{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c26{border-spacing:0;border-collapse:collapse;margin-right:auto}.c23{color:#000000;font-weight:400;font-size:16pt;font-family:"Arial"}.c29{color:#000000;font-weight:400;font-size:26pt;font-family:"Arial"}.c12{text-decoration:none;vertical-align:baseline;font-style:normal}.c31{background-color:#ffffff;max-width:451.4pt;padding:72pt 72pt 72pt 72pt}.c19{padding:0;margin:0}.c22{font-weight:400;font-family:"Consolas"}.c16{color:inherit;text-decoration:inherit}.c18{border:1px solid black;margin:5px}.c15{margin-left:36pt;padding-left:0pt}.c28{font-weight:700}.c4{height:11pt}.c27{font-style:italic}.c25{height:42.8pt}.c17{color:#d1d7e0}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c31 doc-content"><p class="c30 title" id="h.xzqepgt0yyxq"><span>Registry </span><span class="c12 c29">you can actually query</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 336.00px;"><img alt="" src="images/image1.png" style="width: 601.70px; height: 336.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span>Docker registries like </span><span class="c7"><a class="c16" href="https://www.google.com/url?q=http://docker.io&amp;sa=D&amp;source=editors&amp;ust=1766058261306320&amp;usg=AOvVaw2rHKHyehM42UWXwCVaQt9j">docker.io</a></span><span>&nbsp;and</span><span>&nbsp;</span><span class="c7"><a class="c16" href="https://www.google.com/url?q=http://quay.io&amp;sa=D&amp;source=editors&amp;ust=1766058261306496&amp;usg=AOvVaw0XLNsQlCtLaADsAAfhGtgW">quay.io</a></span><span>&nbsp;are public endpoints for browsing and fetching OCI images. You can also run a private registry yourself! </span><span>The registry</span><span>&nbsp;API is </span><span class="c7"><a class="c16" href="https://www.google.com/url?q=https://github.com/opencontainers/distribution-spec/blob/main/spec.md&amp;sa=D&amp;source=editors&amp;ust=1766058261306923&amp;usg=AOvVaw3Ph3TJbMtVwMiNfJ5UHlM-">standardized here</a></span><span>&nbsp;and the most ubiquitous open-source implementation is </span><span class="c7"><a class="c16" href="https://www.google.com/url?q=https://github.com/distribution/distribution&amp;sa=D&amp;source=editors&amp;ust=1766058261307152&amp;usg=AOvVaw17BJ7iEP2KGILw6tbaUwRk">available here</a></span><span class="c6">. Registries can work with myriad data stores, but in practice, they all just run on a comfy and reliable S3-compatible object store. It&#39;s cheap, it&#39;s persistent, it scales to infinity (if you&#39;re willing to renegotiate the &quot;it&#39;s cheap&quot; claim), but there&#39;s one major flaw. Querying arbitrary information about the stored images (e.g. &quot;list all image repositories in this registry, please&quot;) is either:</span></p><ul class="c19 lst-kix_evk7hl6oz3ai-0 start"><li class="c2 c15 li-bullet-0"><span class="c6">painfully slow; or</span></li><li class="c2 c15 li-bullet-0"><span class="c6">painfully unreliable; or</span></li><li class="c2 c15 li-bullet-0"><span class="c6">downright disabled.</span></li></ul><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span class="c6">Wouldn&#39;t the world be a tad more beautiful if there was a registry you can actually query? Let&#39;s implement one!</span></p><h2 class="c5" id="h.k5glv57d4d0w"><span class="c12 c23">Core API</span></h2><p class="c2"><span class="c6">The OCI distribution specification is based on HTTP. It lists all endpoints that a conformant implementation must support, along with their legal methods and status codes for success and failure:</span></p><p class="c2 c4"><span class="c6"></span></p><table class="c26"><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-1</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">GET</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">200</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span><span class="c17">/</span><span class="c10">401</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-2</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">GET</span><span class="c17">&nbsp;/ </span><span class="c10">HEAD</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/blobs/&lt;digest&gt;</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">200</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-3</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">GET</span><span class="c17">&nbsp;/ </span><span class="c10">HEAD</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/manifests/&lt;reference&gt;</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">200</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-4a</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">POST</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/blobs/uploads/</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">202</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-4b</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">POST</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/blobs/uploads/?digest=&lt;digest&gt;</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">201</span><span class="c17">/</span><span class="c10">202</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span><span class="c17">/</span><span class="c10">400</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-5</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">PATCH</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/blobs/uploads/&lt;reference&gt;</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">202</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span><span class="c17">/</span><span class="c10">416</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-6</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">PUT</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/blobs/uploads/&lt;reference&gt;?digest=&lt;digest&gt;</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">201</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span><span class="c17">/</span><span class="c10">400</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-7</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">PUT</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/manifests/&lt;reference&gt;</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">201</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span><span class="c17">/</span><span class="c10">413</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-8a</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">GET</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/tags/list</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">200</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-8b</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">GET</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/tags/list?n=&lt;integer&gt;&amp;last=&lt;tagname&gt;</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">200</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-9</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">DELETE</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/manifests/&lt;reference&gt;</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">202</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span><span class="c17">/</span><span class="c10">400</span><span class="c17">/</span><span class="c10">405</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-10</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">DELETE</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/blobs/&lt;digest&gt;</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">202</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span><span class="c17">/</span><span class="c10">400</span><span class="c17">/</span><span class="c10">405</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-11</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">POST</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/blobs/uploads/?mount=&lt;digest&gt;&amp;from=&lt;other_name&gt;</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">201</span><span class="c17">/</span><span class="c10">202</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-12a</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">GET</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/referrers/&lt;digest&gt;</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">200</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span><span class="c17">/</span><span class="c10">400</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-12b</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">GET</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/referrers/&lt;digest&gt;?artifactType=&lt;artifactType&gt;</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">200</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span><span class="c17">/</span><span class="c10">400</span></p></td></tr><tr class="c25"><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c10 c12">end-13</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c0"><span class="c10">GET</span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c10">/v2/&lt;name&gt;/blobs/uploads/&lt;reference&gt;</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c10">204</span></p></td><td class="c14" colspan="1" rowspan="1"><p class="c0"><span class="c10">404</span></p></td></tr></table><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span>The REST paths are rather self-descriptive, modulo the cryptic &quot;referrers&quot; with an even more cryptic definition: &quot;a list of manifests with a subject relationship to a specified digest.&quot; Let&#39;s forget about these for now. The most important part is storing layers (a.k.a. blobs) and all kinds of metadata about images, their layers, versions, tags, etc. I described the OCI image format in more detail </span><span class="c7"><a class="c16" href="https://www.google.com/url?q=https://writethat.blog/layers.html&amp;sa=D&amp;source=editors&amp;ust=1766058261329782&amp;usg=AOvVaw3kfy7ySY2rRzYtRfNpIiSw">in this post</a></span><span class="c6">.</span></p><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span>How does the official implementation handle all the data management? It can be summed up as &quot;let&#39;s squeeze absolutely everything in S3.&quot; That applies both to data (OCI layers) and metadata (OCI manifests, tags, uploads, etc). It also makes the registry service extremely lightweight, as it doesn&#39;t keep any data itself. It really is barely more than </span><span>syntactic sugar</span><sup><a href="#cmnt1" id="cmnt_ref1">[a]</a></sup><span class="c6">&nbsp;over the S3 API. The standard also specifies that it&#39;s fine to return an HTTP redirect response, which can be used to send presigned S3 requests. Then, users can fetch data from S3 directly. The storage layout is straightforward &ndash; data is kept in one prefix, metadata in another.</span></p><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span class="c1">$ aws s3 ls my-fancy-bucket/docker/registry/v2/</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PRE blobs/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&larr; data goes here</span></p><p class="c2"><span class="c22">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PRE repositories/ &nbsp; &larr; metadata goes here</span></p><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span class="c6">Simple and brilliant, because everything is stored in a single place with high reliability guarantees. It&#39;s also what makes querying so bothersome: most interesting inquiries need to scan a huge S3 bucket. That&#39;s inefficient in two important ways: it&rsquo;s slow and it&rsquo;s expensive.</span></p><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span class="c6">What if we keep metadata somewhere else? Enter SQLite.</span></p><h2 class="c5" id="h.h4hq2evkminm"><span class="c23 c12">Metadata store</span></h2><p class="c2"><span class="c6">The OCI distribution format can be translated to a simple SQL schema. It can look roughly like this:</span></p><p class="c2"><span class="c1">$ sqlite3 registry.db &#39;.schema&#39;</span></p><p class="c2"><span class="c1">CREATE TABLE tags (</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repository TEXT NOT NULL,</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name TEXT NOT NULL,</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRIMARY KEY(repository, name)</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></p><p class="c2"><span class="c1">CREATE TABLE manifests (</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tag_rowid INTEGER NOT NULL,</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;manifest_json TEXT NOT NULL,</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRIMARY KEY(tag_rowid)</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></p><p class="c2"><span class="c1">CREATE TABLE manifest_layers (</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;manifest_rowid INTEGER NOT NULL,</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;layer_digest TEXT NOT NULL,</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;layer_index INTEGER NOT NULL,</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRIMARY KEY(manifest_rowid, layer_digest, layer_index)</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></p><p class="c2"><span class="c1">CREATE TABLE layers (</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;digest TEXT PRIMARY KEY,</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;media_type TEXT NOT NULL,</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size INTEGER NOT NULL</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></p><p class="c2"><span class="c6">CREATE TABLE upload_sessions (</span></p><p class="c2"><span class="c6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;upload_id TEXT PRIMARY KEY,</span></p><p class="c2"><span class="c6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;repository TEXT NOT NULL,</span></p><p class="c2"><span class="c6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;digest TEXT,</span></p><p class="c2"><span class="c6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s3_upload_id TEXT,</span></p><p class="c2"><span class="c6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s3_key TEXT NOT NULL,</span></p><p class="c2"><span class="c6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_size INTEGER,</span></p><p class="c2"><span class="c6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uploaded_size INTEGER DEFAULT 0</span></p><p class="c2"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></p><p class="c2 c4"><span class="c1"></span></p><p class="c2"><span class="c6">Publishing an image boils down to uploading the layers to an object store and updating the metadata:</span></p><ul class="c19 lst-kix_2fga0uz7f54-0 start"><li class="c2 c15 li-bullet-0"><span class="c6">which manifest do the layers belong to;</span></li><li class="c2 c15 li-bullet-0"><span class="c6">which repository and image tag does the uploaded manifest describe;</span></li><li class="c2 c15 li-bullet-0"><span class="c6">etc.</span></li></ul><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span class="c6">Keeping information in SQLite is easy, because it&#39;s just a file. An OCI registry is a distributed system, though, so how can you store everything in a file and pretend it&#39;s scalable? A key observation is that we can store metadata in a &quot;write-through&quot; manner. Save everything in SQLite alright, but also store it in S3, just like the original implementation does. You can then treat SQLite as a fast-yet-powerfully-queryable cache.</span></p><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span class="c6">What if you lose the file or it becomes corrupt?</span></p><h3 class="c21" id="h.q298a5g5ngqk"><span class="c11">Bootstrap</span></h3><p class="c2"><span>First of all, since all the metadata is preserved in S3, the registry can scan the whole bucket and recreate the metadata structure in SQLite. That may take a few centuries for a large repository, but is only done sparingly &ndash; ideally once. The ability to bootstrap from an existing object store bucket also makes the registry a</span><span>&nbsp;&quot;drop-in replacement,&quot; as tech companies love to describe their products.</span><sup><a href="#cmnt2" id="cmnt_ref2">[b]</a></sup></p><h3 class="c21" id="h.s7pc3oxk7zb8"><span class="c11">Turso</span></h3><p class="c2"><span>Now that an SQLite-as-a-Service company (Turso) has entered the market, we can offload the complicated backup and replication bits to them, while still having a simple local file to manage. </span><span class="c7"><a class="c16" href="https://www.google.com/url?q=https://docs.turso.tech/features/embedded-replicas/introduction&amp;sa=D&amp;source=editors&amp;ust=1766058261335017&amp;usg=AOvVaw0gaUFg03GAApvcKkm1miPJ">Embedded replicas</a></span><span>&nbsp;feature looks relevant</span><span>.</span></p><h3 class="c21" id="h.bmj0t9thlwhc"><span class="c11">Backup backup ideas</span></h3><p class="c2"><span>An SQLite</span><sup><a href="#cmnt3" id="cmnt_ref3">[c]</a></sup><sup><a href="#cmnt4" id="cmnt_ref4">[d]</a></sup><span>&nbsp;database is a file, so if you&#39;re somehow </span><span>now </span><span class="c6">enticed by Turso (shame on you), other backup strategies exist. There&rsquo;s &quot;just rsync with cron&quot; and Litestream, to name just two.</span></p><h2 class="c5" id="h.72h9aobcqbl2"><span class="c23 c12">Metadata insights</span></h2><p class="c2"><span>With all metadata kept locally, we can </span><span>unleash </span><sup><a href="#cmnt5" id="cmnt_ref5">[e]</a></sup><sup><a href="#cmnt6" id="cmnt_ref6">[f]</a></sup><span class="c6">SQLite&#39;s full potential and get all kinds of information from our new store.</span></p><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span class="c6">All repositories in the registry, in JSON:</span></p><p class="c2"><span class="c1">&gt; select json_group_array(repository) from tags;</span></p><p class="c2"><span class="c1">[&quot;abc&quot;,&quot;alpine&quot;,&quot;hello-world&quot;,&quot;podman-hello&quot;,&quot;etcd&quot;,&quot;node-ex</span></p><p class="c2"><span class="c1">porter&quot;,&quot;distroless-static&quot;,&quot;distroless-base&quot;,&quot;pause&quot;,&quot;cored</span></p><p class="c2"><span class="c1">ns&quot;,&quot;containerbase&quot;,&quot;nginx&quot;,&quot;redis&quot;,&quot;alpine&quot;,&quot;alpine&quot;] </span></p><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span class="c6">Repositories with the most tags:</span></p><p class="c2"><span class="c1">&gt; select repository, count(name) tags from tags group by repository order by tags desc limit 3;</span></p><p class="c2"><span class="c1">repository &nbsp; &nbsp; tags</span></p><p class="c2"><span class="c1">------------- &nbsp;----</span></p><p class="c2"><span class="c1">alpine &nbsp; &nbsp; &nbsp; &nbsp; 3 &nbsp; </span></p><p class="c2"><span class="c1">abc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; </span></p><p class="c2"><span class="c1">containerbase &nbsp;1 </span></p><p class="c2 c4"><span class="c1"></span></p><p class="c2"><span class="c6">Largest layers with matching image tags:</span></p><p class="c2"><span class="c22">select repository, </span><span class="c22">tags.name</span><span class="c1">&nbsp;tag, (size/1024/1024) || &#39; MiB&#39; size from layers join manifest_layers on digest = layer_digest join tags on manifest_rowid = tags.rowid order by size desc limit 8;</span></p><p class="c2"><span class="c1">repository &nbsp; &nbsp; tag &nbsp; &nbsp; &nbsp; size</span></p><p class="c2"><span class="c1">------------- &nbsp;-------- &nbsp;--------</span></p><p class="c2"><span class="c1">abc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;latest &nbsp; &nbsp;218 MiB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c2"><span class="c1">abc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;latest &nbsp; &nbsp;33 MiB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c2"><span class="c1">containerbase &nbsp;latest &nbsp; &nbsp;28 MiB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c2"><span class="c1">abc &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;latest &nbsp; &nbsp;22 MiB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c2"><span class="c1">nginx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alpine &nbsp; &nbsp;16 MiB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c2"><span class="c1">coredns &nbsp; &nbsp; &nbsp; &nbsp;v1.10.1 &nbsp; 15 MiB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c2"><span class="c1">redis &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7-alpine &nbsp;11 MiB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c2"><span class="c22">node-exporter &nbsp;v1.6.1 &nbsp; &nbsp;9 MiB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span>List layers most frequently reused by multiple manifests</span><span>:</span></p><p class="c2"><span class="c1">select substr(layer_digest, 8, 8) digest, count(*) reused from manifest_layers group by layer_digest order by reused desc limit 3;</span></p><p class="c2"><span class="c1">digest &nbsp; &nbsp;reused</span></p><p class="c2"><span class="c1">-------- &nbsp;------</span></p><p class="c2"><span class="c1">e33bce57 &nbsp;2 &nbsp; &nbsp; </span></p><p class="c2"><span class="c1">b6824ed7 &nbsp;2 &nbsp; &nbsp; </span></p><p class="c2"><span class="c1">9ef7d74b &nbsp;2</span></p><h2 class="c5" id="h.ejb76eeqcknx"><span class="c23 c12">reg</span></h2><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span class="c1">&nbsp;$$$$$$\ &nbsp; $$$$$$\ &nbsp; $$$$$$\ &nbsp;</span></p><p class="c2"><span class="c1">$$ &nbsp;__$$\ $$ &nbsp;__$$\ $$ &nbsp;__$$\ </span></p><p class="c2"><span class="c1">$$ | &nbsp;\__|$$$$$$$$ |$$ / &nbsp;$$ |</span></p><p class="c2"><span class="c1">$$ | &nbsp; &nbsp; &nbsp;$$ &nbsp; ____|$$ | &nbsp;$$ |</span></p><p class="c2"><span class="c1">$$ | &nbsp; &nbsp; &nbsp;\$$$$$$$\ \$$$$$$$ |</span></p><p class="c2"><span class="c1">\__| &nbsp; &nbsp; &nbsp; \_______| \____$$ |</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $$\ &nbsp; $$ |</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \$$$$$$ &nbsp;|</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\______/</span></p><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span>I&#39;m a huge fan of concise naming, so this project is codenamed </span><span class="c7 c28"><a class="c16" href="https://www.google.com/url?q=https://github.com/psarna/reg&amp;sa=D&amp;source=editors&amp;ust=1766058261339386&amp;usg=AOvVaw0CnlKiY670GfvwN4Twm3NE">reg</a></span><span class="c6">, and comes with obligatory low effort 3D ASCII art. Contributions are welcome!</span></p><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span class="c6">It is still very much a work-in-progress, but it can already:</span></p><ul class="c19 lst-kix_dmry3b4ukcx-0 start"><li class="c2 c15 li-bullet-0"><span class="c6">Bootstrap itself from S3.</span></li><li class="c2 c15 li-bullet-0"><span class="c6">Properly process uploads (tested locally with min.io).</span></li><li class="c2 c15 li-bullet-0"><span class="c6">Serve image pulls.</span></li></ul><p class="c2 c4"><span class="c6"></span></p><p class="c2"><span class="c6">In other words, it&#39;s usable enough for local development.</span></p><h2 class="c5" id="h.otw8ro47cqxc"><span>Demo</span></h2><h3 class="c21" id="h.r6xyzraun6ws"><span class="c11">Pushing an image to a local registry</span></h3><p class="c2"><span class="c6">```</span></p><p class="c2"><span class="c1">$ skopeo copy --dest-no-creds --dest-tls-verify=false docker://alpine:3.23 docker://localhost:2137/alpine:3.23</span></p><p class="c2"><span class="c1">Getting image source signatures</span></p><p class="c2"><span class="c1">Copying blob 014e56e61396 skipped: already exists &nbsp;</span></p><p class="c2"><span class="c1">Copying config 7acffee03f done &nbsp; | </span></p><p class="c2"><span class="c1">Writing manifest to image destination</span></p><p class="c2"><span class="c6">```</span></p><h3 class="c21" id="h.sygkguwtkmw7"><span class="c11">Logs from a successful push</span></h3><p class="c2"><span class="c6">```</span></p><p class="c2"><span class="c1">$ go build ./cmd/reg &amp;&amp; AWS_REGION=us-east-1 AWS_PROFILE=minio ./reg serve -b buck</span></p><p class="c2 c4"><span class="c1"></span></p><p class="c2"><span class="c1">&nbsp;$$$$$$\ &nbsp; $$$$$$\ &nbsp; $$$$$$\ &nbsp;</span></p><p class="c2"><span class="c1">$$ &nbsp;__$$\ $$ &nbsp;__$$\ $$ &nbsp;__$$\ </span></p><p class="c2"><span class="c1">$$ | &nbsp;\__|$$$$$$$$ |$$ / &nbsp;$$ |</span></p><p class="c2"><span class="c1">$$ | &nbsp; &nbsp; &nbsp;$$ &nbsp; ____|$$ | &nbsp;$$ |</span></p><p class="c2"><span class="c1">$$ | &nbsp; &nbsp; &nbsp;\$$$$$$$\ \$$$$$$$ |</span></p><p class="c2"><span class="c1">\__| &nbsp; &nbsp; &nbsp; \_______| \____$$ |</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $$\ &nbsp; $$ |</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \$$$$$$ &nbsp;|</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\______/ </span></p><p class="c2 c4"><span class="c1"></span></p><p class="c2"><span class="c1">Server starting on :2137 with bucket &#39;buck&#39;...</span></p><p class="c2"><span class="c1">time=2025-12-17T12:57:50.270+01:00 level=DEBUG msg=getBlob name=alpine blobKey=docker/registry/v2/blobs/sha256/01/014e56e613968f73cce0858124ca5fbc601d7888099969a4eea69f31dcd71a53/data method=HEAD</span></p><p class="c2"><span class="c1">time=2025-12-17T12:57:50.516+01:00 level=DEBUG msg=getBlob name=alpine blobKey=docker/registry/v2/blobs/sha256/7a/7acffee03fe864cd6b88219a1028855d6c912e7cf6fac633aa4307529fd0cc08/data method=HEAD</span></p><p class="c2"><span class="c1">time=2025-12-17T12:57:50.540+01:00 level=DEBUG msg=putManifest name=alpine reference=3.23</span></p><p class="c2"><span class="c1">time=2025-12-17T12:57:50.540+01:00 level=DEBUG msg=&quot;putting manifest blob&quot; blobKey=docker/registry/v2/blobs/sha256/a1/a107a3c031732299dd9dd607bb13787834db2de38cfa13f1993b7105e4814c60/data</span></p><p class="c2"><span class="c1">time=2025-12-17T12:57:50.546+01:00 level=DEBUG msg=&quot;putting manifest meta&quot; metaKey=docker/registry/v2/repositories/alpine/_manifests/tags/3.23/current/link</span></p><p class="c2"><span class="c1">time=2025-12-17T12:57:50.550+01:00 level=DEBUG msg=&quot;putting manifest index meta&quot; metaIndexKey=docker/registry/v2/repositories/alpine/_manifests/tags/3.23/index/sha256/a107a3c031732299dd9dd607bb13787834db2de38cfa13f1993b7105e4814c60/link</span></p><p class="c2"><span class="c1">time=2025-12-17T12:57:50.553+01:00 level=DEBUG msg=&quot;putting manifest revisions meta&quot; revisionsKey=docker/registry/v2/repositories/alpine/_manifests/revisions/sha256/a107a3c031732299dd9dd607bb13787834db2de38cfa13f1993b7105e4814c60/link</span></p><p class="c2"><span class="c1">Put manifest for alpine with reference 3.23</span></p><p class="c2"><span class="c6">```</span></p><h3 class="c21" id="h.9qhx67q2h33"><span class="c11">Pulling and running a container</span></h3><p class="c2"><span class="c6">```</span></p><p class="c2"><span class="c1">$ podman run --tls-verify=0 docker://localhost:2137/alpine:3.19 which busybox</span></p><p class="c2"><span class="c1">Trying to pull localhost:2137/alpine:3.19...</span></p><p class="c2"><span class="c1">Getting image source signatures</span></p><p class="c2"><span class="c1">Copying blob 17a39c0ba978 done &nbsp; | </span></p><p class="c2"><span class="c1">Copying config 83b2b6703a done &nbsp; | </span></p><p class="c2"><span class="c1">Writing manifest to image destination</span></p><p class="c2"><span class="c1">/bin/busybox</span></p><p class="c2"><span class="c6">```</span></p><h3 class="c21" id="h.ewg6shm9b138"><span class="c11">Logs from a successful pull</span></h3><p class="c2"><span class="c6">```</span></p><p class="c2"><span class="c1">time=2025-12-17T13:04:33.652+01:00 level=DEBUG msg=&quot;Retrieved manifest&quot; repo=alpine tag=3.19</span></p><p class="c2"><span class="c1">time=2025-12-17T13:04:33.653+01:00 level=DEBUG msg=getBlob name=alpine blobKey=docker/registry/v2/blobs/sha256/83/83b2b6703a620bf2e001ab57f7adc414d891787b3c59859b1b62909e48dd2242/data method=GET</span></p><p class="c2"><span class="c1">time=2025-12-17T13:04:33.661+01:00 level=DEBUG msg=getBlob name=alpine blobKey=docker/registry/v2/blobs/sha256/17/17a39c0ba978cc27001e9c56a480f98106e1ab74bd56eb302f9fd4cf758ea43f/data method=GET</span></p><p class="c2"><span class="c1">time=2025-12-17T13:05:39.019+01:00 level=DEBUG msg=&quot;Retrieved manifest&quot; repo=alpine tag=3.19</span></p><p class="c2"><span class="c1">time=2025-12-17T13:05:39.021+01:00 level=DEBUG msg=getBlob name=alpine blobKey=docker/registry/v2/blobs/sha256/83/83b2b6703a620bf2e001ab57f7adc414d891787b3c59859b1b62909e48dd2242/data method=GET</span></p><p class="c2"><span class="c1">time=2025-12-17T13:05:39.027+01:00 level=DEBUG msg=getBlob name=alpine blobKey=docker/registry/v2/blobs/sha256/17/17a39c0ba978cc27001e9c56a480f98106e1ab74bd56eb302f9fd4cf758ea43f/data method=GET</span></p><p class="c2"><span>```</span><sup><a href="#cmnt7" id="cmnt_ref7">[g]</a></sup></p><h2 class="c5" id="h.2c5di28453kd"><span class="c23 c12">&#128075;</span></h2><p class="c2"><span>Give it a try! Especially if you also feel like reducing the number of missing features. You might have noticed the glaring </span><span class="c27">--tls-verify=0</span><span>&nbsp;flag passed in every </span><span class="c27">skopeo</span><span>&nbsp;command due to reg&#39;s inability to speak HTTPS.</span></p><div class="c18"><p class="c24"><a href="#cmnt_ref1" id="cmnt1">[a]</a><span class="c6">One total reaction</span></p><p class="c24"><span class="c6">Cynthia Dunlop reacted with &#128512; at 2025-12-17 23:58 pm</span></p></div><div class="c18"><p class="c24"><a href="#cmnt_ref2" id="cmnt2">[b]</a><span class="c6">One total reaction</span></p><p class="c24"><span class="c6">Cynthia Dunlop reacted with &#129320; at 2025-12-18 00:03 am</span></p></div><div class="c18"><p class="c24"><a href="#cmnt_ref3" id="cmnt3">[c]</a><span class="c6">depends if you pronounce it see-quel or S Q L</span></p></div><div class="c18"><p class="c24"><a href="#cmnt_ref4" id="cmnt4">[d]</a><span class="c6">Oh I know, I openly fight the &quot;sequel&quot; pronunciation, I consider it dumb</span></p></div><div class="c18"><p class="c24"><a href="#cmnt_ref5" id="cmnt5">[e]</a><span class="c6">You can never unleash now that ChatGPT ruined it. Or unlock. Sorry.</span></p></div><div class="c18"><p class="c24"><a href="#cmnt_ref6" id="cmnt6">[f]</a><span class="c6">I&#39;ll keep it along with the em dashes, just to mess with those self-proclaimed AI detectives</span></p></div><div class="c18"><p class="c24"><a href="#cmnt_ref7" id="cmnt7">[g]</a><span class="c6">end w something ending-y, like Give it a try! ?</span></p></div></body></html>